# 如何实现注册

## 1. 注册的基本流程

1. 进入注册页面，/register
2. 用户输入用户名，密码和二次密码，注册码
    - 如果多次注册失败，需要输入验证码，验证码由python的captcha库生成，包装成函数，返回验证码图片和验证码字符串
3. 后端接收用户名，密码和二次密码，注册码（验证码）。
4. （验证码正确）
5. 验证两次密码一致
6. 验证密码符合要求，长度大于8位，并且至少包含一个数字，一个大写字母和一个小写字母，一个特殊符号（@#$%^&* ()_+-=）
7. 检测用户名格式正确，只能是英文或数字，长度在4-20之间
8. 验证注册码存在于注册码的数据库表中，并且使用次数不为0
9. 验证用户名不存在与数据库的用户表中
10. 通过验证

## 2. 验证失败的情况

1. 访问日志表，插入注册ip以及请求头中的信息，记录注册失败的次数，如果超过3次，需要输入验证码
2. 访问日志表，插入ip，请求头为null，记录该ip注册总次数，如果超过100次，锁定ip，不允许注册
3. 提示错误信息，让用户重新输入

## 3. 功能实现

1. 网页端注册页面，输入用户名，密码，二次密码，注册码，验证码（可隐藏）；发送post请求到后端
2. 后端接收用户名，密码，二次密码，注册码，验证码
    - 验证码正确
    - 两次密码一致
    - 密码符合要求
    - 用户名符合要求
    - 注册码存在，未被使用
    - 用户名不存在
3. 数据库查询功能：
    - 在注册码表，查询注册码是否存在，是否被使用
    - 在用户表，查询用户名是否存在
    - 注册表，查询注册码对应的等级
4. 数据库插入功能：
    - 插入用户表，用户名，密码，等级，默认使用容量为0（KB），昵称默认为用户名，头像路径为默认头像
    - 插入文件夹表，为用户创建文件夹：hello
    - 插入文件表，为hello文件夹中，添加文件hello.txt，内容为`hello`，这个文件事先存在于文件表中，
5. 数据库更新功能：
    - 注册码表，注册码更新为已使用
