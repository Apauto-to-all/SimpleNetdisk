# 登入功能的实现

## 1. 登入功能的基本流程

1. 进入登入页面，/login
2. 用户输入用户名，密码，验证码
    - 如果多次登入失败，需要输入验证码，验证码由python的captcha库生成，包装成函数，返回验证码图片和验证码字符串
3. 后端接收用户名，密码，验证码
4. （验证码正确）
4. 验证用户名和密码，存在用户表中
5. 通过验证

## 2. 验证失败的情况

1. 访问日志表，插入登入ip以及请求头中的信息，记录登入失败的次数，如果超过3次，需要输入验证码
2. 访问日志表，插入ip，请求头为null，记录该ip登入总次数，如果超过100次，锁定ip，不允许登入
3. 提示错误信息，让用户重新输入

## 3. 功能实现

1. 网页端登入页面，输入用户名，密码，验证码（可隐藏）发送post请求到后端
2. 后端接收用户名，密码，验证码
    - 验证码正确
    - 用户名和密码正确
3. 数据库查询功能：
    - 在用户表，查询用户名和密码是否存在
    - 密匙表，查询密匙，如果密匙过期，重新生成密匙
4. 登入成功
    - 利用此密匙，和JWT库，生成token，设置过期时间为30min
    - 将token存入cookie中，同样设置过期时间30min
    - 跳转到网盘主页，`/用户名/`
