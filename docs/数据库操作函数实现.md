# 数据库函数实现

- [ ] 未完成的任务
- [x] 已完成的任务

简单说明：后端需要实现的数据库函数，下面是具体的函数实现，实现后标记`x`意为已完成
**注意：** 
1. **文档**：请在`docs`文件夹下为你的代码创建相应的文档。描述函数功能，以及如何使用。
2. **注释**：请在你的代码中添加适当的注释，以解释你的代码是如何工作的。特别是对于复杂的算法和技巧，应该详细解释其工作原理。
3. **测试**：提交代码前必须进行测试，确保代码没有问题。
4. **错误处理**：确保不抛出异常，对于错误情况，返回`false`或`None`，我简单说明了一些错误处理，可能不全面，你需要根据实际情况进行处理。
5. 万事无绝对，我可能会根据实际情况进行调整，注意查看更新。（如果你已经完成这个函数，我会提醒修改；如果还没实现，就需要注意查看更新情况）
6. 对其要求有疑惑的地方，可以看设计文档，或者在群里提问
7. 功能在哪实现？在`db`文件夹下实现，文件名任意，但是要有意义，比如连接数据库的文件可以命名为`connection.py`

### 用户表
- [ ] 函数传入：用户名（查询密码，用于登入）
    - 实现功能：`查询`数据库中用户名对应的密码
    - 错误处理：如果用户名不存在，返回`None`
    - 返回值：密码

- [ ] 函数传入：用户名（验证是否存在该用户名）
    - 实现功能：`查询`数据库中是否存在该用户名
    - 返回值：是否存在`bool`类型，存在返回`true`，不存在返回`false`

附加操作的表：等级表
- [ ] 函数传入：用户名（查询用户的信息）
    - 实现功能：`查询`用户名对应的头像路径，昵称，等级对应的最大容量，使用容量
    - 返回值：头像路径，昵称，等级对应的最大容量，使用容量

- [ ] 函数传入：用户名，头像路径，昵称（更新头像路径，昵称）
    - 实现功能：`更新`用户名对应的头像路径，昵称
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

- [ ] 函数传入：用户名，密码（更新密码）
    - 实现功能：`更新`用户名对应的密码
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

附加操作的表：注册码表，等级表
- [ ] 函数传入：用户名，密码和注册码（注册）
    - 实现功能：`插入`该用户名和密码，等级为注册码对应的等级，注册码使用次数-1，其他信息默认
    - 错误处理：如果注册码不存在，返回`false`，如果注册码使用次数小于等于0，返回`false`，如果用户名已存在，返回`false`
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`

### 访问日志表
- [ ] 函数传入：ip+浏览器请求头（记录用户错误登入/注册次数）
    - 功能实现：
        1. `查询`数据库中是否存在该ip和浏览器请求头
        2. 如果存在，则`更新`登入失败次数+1
        3. 如果不存在，则`插入`该ip和浏览器请求头，登入失败次数为1
    - 返回值：ip+浏览器请求头对应的登入失败次数

- [ ] 函数传入：ip（记录一个ip的错误登入/注册次数）
    - 功能实现：
        1. `查询`数据库中是否存在该ip（请求头为空）
        2. 如果存在，则`更新`登入失败次数+1
        3. 如果不存在，则`插入`该ip，登入失败次数为1
    - 返回值：ip对应的登入失败次数

- [ ] 函数传入：ip+浏览器请求头（登入或注册成功后清空登入失败次数）
    - 功能实现：`更新`ip+浏览器请求头对应的登入失败次数为0，如果不存在则`插入`
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

- [ ] 函数传入：无（清空访问日志表）
    - 功能实现：清空访问日志表的所有数据
    - 错误处理：如果因为某些原因清空失败，返回`false`
    - 返回值：如果清空成功返回`true`，否则返回`false`

### 密匙表
- [ ] 函数传入：无（获取密匙，如果密匙是否过期放回空密匙）
    - 功能实现：`查询`数据库中的密匙对应的过期时间，与当前时间比较
    - 返回值：密匙（如果密匙过期返回空密匙）

- [ ] 函数传入：密匙（密匙是否存在）
    - 功能实现：`插入`密匙
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`


### 等级表
- [ ] 函数传入：等级，最大容量（KB），最大上传文件大小（KB），回收站保存时间（天）（初始化，插入等级）
    - 功能实现：`插入`等级和对应的最大容量，最大上传文件大小，回收站保存时间
    - 错误处理：如果等级已存在，返回`false`
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`

### 注册码表
- [ ] 函数传入：注册码（检查注册码是否存在，是否可用）
    - 功能实现：`查询`数据库中是否存在该注册码
    - 错误处理：如果使用次数小于0，返回`false`
    - 返回值：是否存在`bool`类型，存在返回`true`，不存在返回`false`

- [ ] 函数传入：注册码 + 注册码对应的等级 + 使用次数（初始化，插入注册码）
    - 功能实现：`插入`该注册码和对应的等级和使用次数
    - 错误处理：如果注册码已存在，返回`false`，如果等级不存在，返回`false`，如果使用次数小于0，返回`false`
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`

### 文件表
- [ ] 函数传入：文件id，用户名（检查文件是否为用户所有）
    - 功能实现：`查询`数据库中用户名是否有该文件id
    - 返回值：是否存在`bool`类型，存在返回`true`，不存在返回`false`

- [ ] 函数传入：文件id，用户名（删除文件）
    - 功能实现：`更新`数据库中用户名对应的文件id的文件是否被删除为`true`
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

- [ ] 函数传入：文件id，用户名（获取文件路径，用于下载文件）
    - 功能实现：`查询`数据库中用户名对应的文件id的文件路径
    - 返回值：文件路径

- [ ] 函数传入：文件id，用户名（获取文件信息）
    - 功能实现：`查询`数据库中用户名对应的文件id的信息
    - 返回值：文件名，文件大小，文件创建时间

- [ ] 函数传入：文件id，文件夹id，用户名，文件名，文件大小，文件路径（上传文件）
    - 功能实现：`插入`文件信息，文件是否被删除默认为`false`，文件创建时间为当前时间
    - 错误处理：如果文件id已存在，返回`false`
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`

### 文件夹表
- [ ] 函数传入：文件夹id，用户名（检查文件夹是否为用户所有）
    - 功能实现：`查询`数据库中用户名是否有该文件夹id
    - 返回值：是否存在`bool`类型，存在返回`true`，不存在返回`false`

- [ ] 函数传入：文件夹id，用户名（删除文件夹）
    - 功能实现：`更新`数据库中用户名对应的文件夹id的文件夹是否被删除为`true`
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

- [ ] 函数传入：文件夹id，用户名，密码（加密文件夹）
    - 功能实现：`更新`数据库中用户名对应的文件夹id的文件夹密码
    - 返回值：是否更新成功`bool`类型，成功返回`true`，失败返回`false`

- [ ] 函数传入：文件夹id，用户名（获取文件夹密码，用于解密）
    - 功能实现：`查询`数据库中用户名对应的文件夹id的文件夹密码
    - 返回值：文件夹密码

- [ ] 函数传入：文件夹id，用户名（获取文件夹信息）
    - 功能实现：`查询`数据库中用户名对应的文件夹id的文件夹信息
    - 返回值：文件夹名，文件夹创建时间

- [ ] 函数传入：文件夹id，用户名（获取文件夹层级）
    - 功能实现：`查询`数据库中用户名对应的文件夹id的文件夹层级
    - 返回值：文件夹层级

- [ ] 函数传入：文件夹id，用户名，文件夹名，父级文件夹id，父类文件夹层级（创建文件夹）
    - 功能实现：`插入`文件夹信息，文件夹是否被删除默认为`false`，文件夹创建时间为当前时间，文件层级：为父类文件夹层级+父类文件夹id（通过字符串拼接）
    - 错误处理：如果文件夹id已存在，返回`false`
    - 返回值：是否插入成功`bool`类型，成功返回`true`，失败返回`false`