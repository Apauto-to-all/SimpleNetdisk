<!DOCTYPE html>
<html>

<head>
    <title>Êñá‰ª∂Ê†ë</title>
    <style>
        .icon::before {
            content: "üìÅ ";
        }

        .folder {
            margin-left: 20px;
        }

        .toggle {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            margin-right: 5px;
            border: 1px solid black;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="file-tree"></div>
    <script>
        async function getFolders(parentFolderId = '/') {
            try {
                const response = await fetch(`/getfolders?parent_folder_id=${parentFolderId}`, {
                    method: 'GET',
                    // ÈúÄË¶ÅÊ∑ªÂä†ÈÄÇÂΩìÁöÑheadersÔºå‰æãÂ¶ÇÁî®‰∫éËÆ§ËØÅÁöÑCookie
                });
                const folders = await response.json();
                if (response.ok) {
                    return folders;
                } else {
                    throw new Error('Failed to fetch folders');
                }
            } catch (error) {
                console.error('Error fetching folders:', error);
                return {};
            }
        }

        async function buildFileTree(parentFolderId, parentElement, level = 0) {
            const folders = await getFolders(parentFolderId);
            if (Object.keys(folders).length === 0) {
                const noFolderMsg = document.createElement('div');
                noFolderMsg.textContent = 'Êó†Êñá‰ª∂Â§π';
                parentElement.appendChild(noFolderMsg);
            } else {
                Object.entries(folders).forEach(([uuid, folderName]) => {
                    const folderElement = document.createElement('div');
                    folderElement.className = 'folder';
                    folderElement.style.marginLeft = `${level * 20}px`;

                    const toggleButton = document.createElement('span');
                    toggleButton.className = 'toggle';
                    toggleButton.textContent = '+';
                    toggleButton.onclick = function (event) {
                        event.stopPropagation(); // Èò≤Ê≠¢‰∫ã‰ª∂ÂÜíÊ≥°
                        if (toggleButton.textContent === '+') {
                            // Â±ïÂºÄÂ≠êÊñá‰ª∂Â§π
                            buildFileTree(uuid, folderElement, level + 1).then(() => {
                                toggleButton.textContent = '-';
                            });
                        } else {
                            // Êî∂Ëµ∑Â≠êÊñá‰ª∂Â§π
                            while (folderElement.lastChild !== folderNameElement) {
                                folderElement.removeChild(folderElement.lastChild);
                            }
                            toggleButton.textContent = '+';
                        }
                    };

                    const iconElement = document.createElement('span');
                    iconElement.className = 'icon';

                    const folderNameElement = document.createElement('span');
                    folderNameElement.textContent = ` ${folderName}`;

                    folderElement.appendChild(toggleButton);
                    folderElement.appendChild(iconElement); // Â∞ÜÂõæÊ†áÂÖÉÁ¥†Ê∑ªÂä†Âà∞folderElement‰∏≠ÔºåÁ¥ßË∑üÂú®toggleButton‰πãÂêé
                    folderElement.appendChild(folderNameElement);

                    parentElement.appendChild(folderElement);
                });
            }
        }

        window.onload = function () {
            const fileTreeRoot = document.getElementById('file-tree');
            buildFileTree('/', fileTreeRoot);
        };
    </script>
</body>

</html>